.. _encoding:

Пространственное и спектральное кодирование
============================================


В МРТ сигнал принимается со всего объема образца (например, головы пациента) одновременно. Без специальных механизмов мы получили 
бы лишь одну сумму всех сигналов, неспособную создать изображение. Для создания двумерного или трехмерного изображения необходимо закодировать 
позиционную информацию в принимаемом сигнале. Это достигается с помощью градиентных магнитных полей и манипуляций с частотой и фазой 
радиочастотных импульсов.

Для создания 2D-изображения используется трехэтапный процесс кодирования по трем осям: 
**выбор среза (Slice Selection), фазовое кодирование (Phase Encoding) и частотное кодирование (Frequency Encoding)**.

Градиентное магнитное поле создается с помощью встроенных в томограф градиентных катушек:
:math:`B = B_0 + (\vec{r} \cdot \vec{G})`,
где :math:`\vec{G}` — градиент поля.

Градиент делает магнитное поле а, следовательно, и резонансную частоту линейно зависящим от положения вдоль направления :math:`\vec{r}`:

:math:`\omega = \gamma(B_0 + (\vec{r} \cdot \vec{G}))`

Выбор среза
------------
При однородном поле B₀ все протоны прецессируют с одной частотой. Чтобы возбудить только определенный срез, 
применяется магнитный градиент вдоль одной из осей (например, Z) **одновременно с РЧ-импульсом**.

РЧ-импульс имеет узкую полосу частот (bandwidth). Он будет возбуждать только те протоны, чья резонансная частота попадает в эту полосу.Таким образом, 
возбуждается не весь объем, а только тонкий срез, перпендикулярный оси градиента.

Толщина среза :math:`\Delta z` определяется амплитудой градиента :math:`G_z` и шириной полосы РЧ-импульса  :math:`\Delta f`:

.. math::
   \Delta z = \dfrac{2 \pi \Delta f}{\gamma G_z }


Частотное кодирование
---------------------

Частотное кодирование осуществляется за счет включения градиентного поля **после РЧ-импульса во время считывания сигнала**.


Изменение сигнала при приложении градиентного поля
---------------------------------------------------
Рассмотрим, как изменяется сигнал, если включить градиентное поле **после РЧ-импульса во время считывания сигнала**. Для этого подставим 
выражение для градиентного поля в уравнение Блоха. 

.. math::
   \begin{aligned}
   \vec{B} &= B_0 + (\vec{G} \cdot \vec{r}) \\
   \frac{d\vec{M}}{dt} &= \gamma \left[ \vec{M} \times \vec{B} \right]
   \end{aligned}

Решением уравнения является следующее выражение (избежать рассмотрения вращения намагниченности 
с частотой :math:`\omega_0` можно, если перейти во вращающуюся систему отсчета):

.. math::
   M_{\perp}(\vec{r}, t) = M(\vec{r}) e^{-i \gamma \int_0^t (\vec{G} \cdot \vec{r}) d\tau}

Сигнал, регистрируемый на катушке, -- интеграл по объему от намагниченности:

.. math::
   \xi(t) = \int M(\vec{r}) e^{-i \gamma \int_0^t (\vec{G} \cdot \vec{r}) d\tau} d\vec{r}


Сделав замену переменных :math:`k = \gamma \int_0^t G(\tau) \, d\tau`, получим:

.. math::
   \xi(k) = \int M(\vec{r}) \, e^{-i(\vec{k} \cdot \vec{r})} \, d\vec{r}

Полученное выражение представляет собой преобразование Фурье с парами :math:`(\vec{k}, \vec{r})`. Далее с помощью обратного рпеобразования Фурье можем получить
распределение намагниченности из сигнала:

.. math::
   \mathcal{F}\mathcal{T}[\xi(k)] = M(\vec{r})

.. math::
   M(\vec{r}) \approx \text{число протонов в точке с координатами } \vec{r}

k-пространство
---------------

Для осуществления пространственной локализации необходимо собрать данные о сигнале при различных значениях :math:`\vec{k}`.
Каждая точка в k-пространстве содержит информацию о пространственной частоте **всего изображения**.



Свойства:

 * Центр (k=0): Соответствует общей интенсивности сигнала (контрасту).

 * Периферия (высокие k): Соответствует мелким деталям и краям (разрешение).

Симметрия: K-пространство обладает свойством комплексной симметрии (сопряженной симметрии), что используется в методах частичного считывания.